<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CC X CIE - Treasure Hunt</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">

  <!-- CodeMirror JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>

  <style>
    :root {
      --bg-primary: #0a0e27;
      --bg-secondary: #141b2d;
      --bg-tertiary: #1a2332;
      --bg-card: #1e293b;
      --accent-primary: #6366f1;
      --accent-secondary: #8b5cf6;
      --accent-tertiary: #06b6d4;
      --accent-danger: #ef4444;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-color: #1e293b;
      --border-light: #334155;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
      --shadow-glow: 0 0 20px rgba(99, 102, 241, 0.3);
      --shadow-glow-cyan: 0 0 20px rgba(6, 182, 212, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1f3a 50%, #0f172a 100%);
      background-attachment: fixed;
      color: var(--text-primary);
      min-height: 100vh;
      padding: 0;
      direction: ltr;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Animated background particles */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 2rem;
      position: relative;
      z-index: 1;
    }

    /* ---------- HEADER ----------- */
    .header {
      grid-column: 1 / -1;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .header h1 {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      text-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
    }

    .header p {
      color: var(--text-secondary);
      font-size: 1.15rem;
      font-weight: 400;
    }

    .header strong {
      color: var(--accent-tertiary);
      font-weight: 600;
    }

    /* ---------- STATUS PANEL ----------- */
    .status-panel {
      position: sticky;
      top: 2rem;
      height: fit-content;
      max-height: calc(100vh - 4rem);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    #status {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 3.5rem 1.5rem 1.5rem 1.5rem;
      min-height: 200px;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      color: var(--success);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow-x: hidden;
    }

    #status::before {
      content: 'STATUS';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 0.875rem 1.5rem;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      font-size: 0.75rem;
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border-radius: 16px 16px 0 0;
      z-index: 1;
      font-family: 'Inter', sans-serif;
    }

    #status::-webkit-scrollbar {
      width: 8px;
    }

    #status::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
      border-radius: 4px;
    }

    #status::-webkit-scrollbar-thumb {
      background: var(--accent-primary);
      border-radius: 4px;
    }

    #status::-webkit-scrollbar-thumb:hover {
      background: var(--accent-secondary);
    }

    /* ---------- MAIN CONTENT ----------- */
    .main-content {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    /* ---------- MAZE PREVIEW IMAGE ----------- */
    .maze-preview {
      width: 100%;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .maze-preview:hover {
      box-shadow: var(--shadow-lg);
      border-color: var(--border-light);
      transform: scale(1.02);
    }

    .maze-preview img {
      width: 100%;
      height: auto;
      display: block;
      object-fit: contain;
      transition: transform 0.3s ease;
    }

    .maze-preview:hover img {
      transform: scale(1.05);
    }

    /* ---------- MODAL LIGHTBOX ----------- */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease;
      cursor: pointer;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
      animation: zoomIn 0.3s ease;
      cursor: default;
    }

    .modal-content img {
      width: 100%;
      height: auto;
      max-height: 90vh;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
    }

    .modal-close {
      position: absolute;
      top: -40px;
      right: 0;
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.5rem;
      font-weight: bold;
      transition: all 0.3s ease;
      z-index: 10001;
    }

    .modal-close:hover {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      transform: rotate(90deg);
    }

    @keyframes zoomIn {
      from {
        transform: scale(0.8);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .section {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: var(--shadow-md);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .section:hover {
      box-shadow: var(--shadow-lg);
      border-color: var(--border-light);
    }

    .section-title {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .section-title::before {
      content: '';
      width: 5px;
      height: 28px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-tertiary));
      border-radius: 3px;
      box-shadow: var(--shadow-glow-cyan);
    }

    /* ---------- COMMAND CARDS ----------- */
    .commands-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.25rem;
      margin-bottom: 2rem;
    }

    .command-box {
      background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-card));
      border: 1px solid var(--border-color);
      border-radius: 14px;
      padding: 1.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
      position: relative;
      overflow: hidden;
    }

    .command-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-tertiary));
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .command-box:hover {
      transform: translateY(-4px);
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-glow);
    }

    .command-box:hover::before {
      transform: scaleX(1);
    }

    .command-title {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      color: var(--accent-tertiary);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
    }

    .command-title::before {
      content: '‚ö°';
      font-size: 1.2rem;
      filter: drop-shadow(0 0 4px var(--accent-primary));
    }

    .command-desc {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.6;
    }

    .command-example {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      background: var(--bg-primary);
      color: var(--accent-tertiary);
      padding: 0.875rem 1rem;
      border-radius: 10px;
      white-space: pre;
      border: 1px solid var(--border-color);
      display: block;
      transition: all 0.3s ease;
    }

    .command-box:hover .command-example {
      border-color: var(--accent-primary);
      box-shadow: 0 0 10px rgba(99, 102, 241, 0.2);
    }

    /* ---------- RULES BOX ----------- */
    .rules-box {
      margin: 2rem 0;
      padding: 1.75rem;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 158, 11, 0.1));
      color: var(--text-primary);
      border: 2px solid var(--accent-danger);
      border-radius: 14px;
      font-family: 'JetBrains Mono', monospace;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(239, 68, 68, 0.1);
    }

    .rules-box::before {
      content: '‚ö†Ô∏è';
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 2rem;
      opacity: 0.3;
    }

    .rules-box p {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.8;
      color: var(--text-primary);
      white-space: pre-line;
    }

    .rules-box strong {
      color: var(--warning);
      font-weight: 600;
    }

    /* ---------- CODE EDITOR ----------- */
    .editor-container {
      margin-bottom: 1.5rem;
    }

    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .editor-label {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .editor-label::before {
      content: 'üìù';
      font-size: 1rem;
    }

    #editor-wrapper,
    #editor-wrapper-level2 {
      height: 380px;
      border: 1px solid var(--border-color);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      background: var(--bg-primary);
      transition: all 0.3s ease;
    }

    #editor-wrapper:focus-within,
    #editor-wrapper-level2:focus-within {
      border-color: var(--accent-primary);
      box-shadow: var(--shadow-glow);
    }

    .CodeMirror {
      height: 100%;
      font-size: 15px;
      font-family: 'JetBrains Mono', monospace;
    }

    .CodeMirror-scroll {
      padding: 1.25rem;
    }

    /* ---------- BUTTONS ----------- */
    .button-group {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }

    button {
      padding: 1rem 2rem;
      font-size: 0.95rem;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:hover::before {
      width: 300px;
      height: 300px;
    }

    button:active {
      transform: scale(0.96);
    }

    #runBtn,
    #runLevel2Btn {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      box-shadow: var(--shadow-md);
    }

    #runBtn:hover,
    #runLevel2Btn:hover {
      box-shadow: var(--shadow-glow);
      transform: translateY(-2px);
    }

    #runBtn::after {
      content: '‚ñ∂';
      font-size: 0.8rem;
    }

    #runLevel2Btn::after {
      content: '‚ñ∂';
      font-size: 0.8rem;
    }

    #nextLevelBtn {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
    }

    #nextLevelBtn:hover {
      background: var(--bg-primary);
      border-color: var(--accent-primary);
      box-shadow: 0 0 15px rgba(99, 102, 241, 0.2);
    }

    #nextLevelBtn::after {
      content: '‚Üí';
      font-size: 1.2rem;
    }

    /* ---------- LEVEL 2 SECTION ----------- */
    #level2-section {
      margin-top: 2rem;
      padding-top: 2.5rem;
      border-top: 2px solid var(--border-color);
      display: none;
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .note {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      padding: 1.25rem;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.1));
      border-left: 4px solid var(--warning);
      border-radius: 10px;
      line-height: 1.7;
    }

    .note strong {
      color: var(--warning);
      font-weight: 700;
    }

    /* ---------- RESPONSIVE ----------- */
    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
        padding: 1.5rem;
      }

      .status-panel {
        position: relative;
        top: 0;
      }

      #status {
        max-height: 300px;
      }

      .header h1 {
        font-size: 2.5rem;
      }
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 2rem;
      }

      .commands-container {
        grid-template-columns: 1fr;
      }

      .section {
        padding: 1.5rem;
      }

      #editor-wrapper,
      #editor-wrapper-level2 {
        height: 300px;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
        justify-content: center;
      }
    }

    /* ---------- ANIMATIONS ----------- */
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.6;
      }
    }

    .status-typing {
      animation: pulse 1.5s ease-in-out infinite;
    }

    /* Smooth scroll */
    html {
      scroll-behavior: smooth;
    }
  </style>

</head>
<body>

<!-- MODAL LIGHTBOX -->
<div class="modal-overlay" id="imageModal">
  <div class="modal-content">
    <span class="modal-close" id="closeModal">&times;</span>
    <img id="modalImage" src="" alt="Maze Preview - Zoomed">
  </div>
</div>

<div class="container">
  <div class="header">
    <h1>üè¥‚Äç‚ò†Ô∏è CIE X CC</h1>
    <p>You are the <strong>player</strong>. Use the commands below to escape the maze.</p>
  </div>

  <!-- STATUS PANEL -->
  <div class="status-panel">
    <div id="status"></div>
    <!-- MAZE PREVIEW -->
    <div class="maze-preview" id="mazePreview">
      <img src="IMG.jpg" alt="Maze Preview" id="mazeImage">
    </div>
  </div>

  <div class="main-content">

    <!-- COMMAND REFERENCE -->
    <div class="section">
      <h2 class="section-title">Command Reference</h2>
      <div class="commands-container">
        <div class="command-box">
          <div class="command-title">move_up()</div>
          <div class="command-desc">Moves the player one tile upward.</div>
          <div class="command-example">move_up()</div>
        </div>

        <div class="command-box">
          <div class="command-title">move_down()</div>
          <div class="command-desc">Moves the player one tile downward.</div>
          <div class="command-example">move_down()</div>
        </div>

        <div class="command-box">
          <div class="command-title">move_left()</div>
          <div class="command-desc">Moves the player one tile to the left.</div>
          <div class="command-example">move_left()</div>
        </div>

        <div class="command-box">
          <div class="command-title">move_right()</div>
          <div class="command-desc">Moves the player one tile to the right.</div>
          <div class="command-example">move_right()</div>
        </div>
      </div>

      <div class="rules-box">
        <p>If you:
- move into a wall  -> window closes
- move out of bounds -> window closes

At the end we will check if you reached the goal.</p>
      </div>
    </div>

    <!-- LEVEL 1 -->
    <div class="section">
      <h2 class="section-title">Level 1 - Your Code</h2>
      <p class="note">Challenge: Use <strong>as many lines as you want</strong> to solve the maze.</p>
      <div class="editor-container">
        <div class="editor-header">
          <span class="editor-label">Python Editor</span>
        </div>
        <div id="editor-wrapper">
          <textarea id="code"></textarea>
        </div>
      </div>
      <div class="button-group">
        <button id="runBtn">Run Code</button>
        <button id="nextLevelBtn">Next Level</button>
      </div>
    </div>

    <!-- LEVEL 2 -->
    <div id="level2-section" class="section">
      <h2 class="section-title">Level 2 - Use a for loop</h2>
      <p class="note">Challenge: Use a <strong>for loop</strong> to solve the maze.</p>
      <div class="editor-container">
        <div class="editor-header">
          <span class="editor-label">Python Editor</span>
        </div>
        <div id="editor-wrapper-level2">
          <textarea id="codeLevel2"></textarea>
        </div>
      </div>
      <div class="button-group">
        <button id="runLevel2Btn">Run Level 2</button>
      </div>
    </div>
  </div>
</div>

<script>
  /* -------- IMAGE MODAL FUNCTIONALITY -------- */
  const mazePreview = document.getElementById("mazePreview");
  const mazeImage = document.getElementById("mazeImage");
  const modal = document.getElementById("imageModal");
  const modalImage = document.getElementById("modalImage");
  const closeModal = document.getElementById("closeModal");

  // Open modal on image click
  mazePreview.addEventListener("click", () => {
    modalImage.src = mazeImage.src;
    modal.classList.add("active");
    document.body.style.overflow = "hidden"; // Prevent background scrolling
  });

  // Close modal on close button click
  closeModal.addEventListener("click", (e) => {
    e.stopPropagation();
    modal.classList.remove("active");
    document.body.style.overflow = ""; // Restore scrolling
  });

  // Close modal on overlay click (outside image)
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.classList.remove("active");
      document.body.style.overflow = ""; // Restore scrolling
    }
  });

  // Close modal on ESC key
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && modal.classList.contains("active")) {
      modal.classList.remove("active");
      document.body.style.overflow = ""; // Restore scrolling
    }
  });

  /* -------- LEVEL 1 EDITOR -------- */
  const editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    mode: "python",
    theme: "dracula",
    lineNumbers: true,
    indentUnit: 4,
    tabSize: 4,
    smartIndent: true,
    lineWrapping: true,
    autofocus: true,
  });

  editor.setValue(`# Example: Navigate to the goal
move_right()
move_right()
move_down()
move_down()
# Continue with your solution...
`);

  const statusDiv = document.getElementById("status");

  // ----- idle messages (before first run) -----
  let hasRun = false;
  const idleMessages = [
    "Ready?...",
    "Made with love by CC & CIE ‚ù§Ô∏è"
  ];

  // ---------- TYPEWRITER ANIMATION ----------
  function typeWriter(text, callback) {
    let i = 0;
    statusDiv.textContent = "";
    statusDiv.classList.add("status-typing");

    function typing() {
      if (hasRun) {
        statusDiv.classList.remove("status-typing");
        return;
      }

      if (i < text.length) {
        statusDiv.textContent += text.charAt(i);
        i++;
        setTimeout(typing, 60);
      } else {
        statusDiv.classList.remove("status-typing");
        setTimeout(callback, 7500);
      }
    }

    typing();
  }

  function startIdleAnimation() {
    let idx = 0;

    function nextMessage() {
      if (hasRun) return;
      typeWriter(idleMessages[idx], () => {
        idx = (idx + 1) % idleMessages.length;
        nextMessage();
      });
    }

    nextMessage();
  }

  startIdleAnimation();

  /* -------- RUN LEVEL 1 -------- */
  document.getElementById("runBtn").addEventListener("click", async () => {
    hasRun = true;
    statusDiv.classList.remove("status-typing");

    const code = editor.getValue().trim();

    if (!code) {
      statusDiv.textContent = "‚ö†Ô∏è Please write your code first.";
      statusDiv.style.color = "var(--warning)";
      setTimeout(() => {
        statusDiv.style.color = "var(--success)";
      }, 3000);
      return;
    }

    statusDiv.textContent = "üîÑ Running Level 1...";
    statusDiv.style.color = "var(--accent-tertiary)";

    try {
      const response = await fetch("/run", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code }),
      });

      const result = await response.json();
      
      if (response.ok) {
        statusDiv.textContent = "‚úÖ " + result.message;
        statusDiv.style.color = "var(--success)";
      } else {
        statusDiv.textContent = "‚ùå Error: " + result.message;
        statusDiv.style.color = "var(--error)";
      }

    } catch (err) {
      statusDiv.textContent = "‚ùå Connection error: " + err.message;
      statusDiv.style.color = "var(--error)";
    }
  });

  /* -------- LEVEL 2 INIT -------- */
  let editorLevel2 = null;
  const level2Section = document.getElementById("level2-section");

  document.getElementById("nextLevelBtn").addEventListener("click", () => {
    level2Section.style.display = "block";
    level2Section.scrollIntoView({ behavior: "smooth", block: "nearest" });

    if (!editorLevel2) {
      editorLevel2 = CodeMirror.fromTextArea(document.getElementById("codeLevel2"), {
        mode: "python",
        theme: "dracula",
        lineNumbers: true,
        indentUnit: 4,
        tabSize: 4,
        smartIndent: true,
        lineWrapping: true,
      });

      editorLevel2.setValue(`# Use a for loop to solve the maze
`);
    }
  });

  /* -------- RUN LEVEL 2 -------- */
  document.getElementById("runLevel2Btn").addEventListener("click", async () => {
    hasRun = true;
    statusDiv.classList.remove("status-typing");

    if (!editorLevel2) {
      statusDiv.textContent = "‚ö†Ô∏è Please open Level 2 first.";
      statusDiv.style.color = "var(--warning)";
      setTimeout(() => {
        statusDiv.style.color = "var(--success)";
      }, 3000);
      return;
    }

    const code2 = editorLevel2.getValue().trim();

    if (!code2) {
      statusDiv.textContent = "‚ö†Ô∏è Write Level 2 code first.";
      statusDiv.style.color = "var(--warning)";
      setTimeout(() => {
        statusDiv.style.color = "var(--success)";
      }, 3000);
      return;
    }

    statusDiv.textContent = "üîÑ Running Level 2...";
    statusDiv.style.color = "var(--accent-tertiary)";

    try {
      const response = await fetch("/run", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code: code2 }),
      });

      const result = await response.json();
      
      if (response.ok) {
        statusDiv.textContent = "‚úÖ Level 2 running...";
        statusDiv.style.color = "var(--success)";
      } else {
        statusDiv.textContent = "‚ùå Error: " + result.message;
        statusDiv.style.color = "var(--error)";
      }

    } catch (err) {
      statusDiv.textContent = "‚ùå Connection error: " + err.message;
      statusDiv.style.color = "var(--error)";
    }
  });

</script>

</body>
</html>
